# Ant Build Configuration

> **Relevant source files**
> * [build.xml](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/build.xml)
> * [nbproject/build-impl.xml](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml)
> * [nbproject/genfiles.properties](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/genfiles.properties)

## Purpose and Scope

This document details the Apache Ant build configuration for the `crud3` application. It covers the structure of the build system, the relationship between configuration files, available build targets, property initialization sequences, and customization mechanisms.

For information about the complete build lifecycle and target execution order, see [Build Targets and Lifecycle](/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/7.2-build-targets-and-lifecycle). For NetBeans-specific project configuration, see [NetBeans Project Structure](/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/7.3-netbeans-project-structure). For dependency management and classpath configuration, see [Dependencies and Classpath](/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/7.4-dependencies-and-classpath).

---

## Build File Architecture

The build system consists of two primary XML files that work together to provide a complete Ant-based build process.

```

```

**Diagram: Build Configuration File Relationships**

The build system follows a two-tier architecture where user customizations in `build.xml` import and can override targets from the auto-generated `build-impl.xml`.

**Sources:** [build.xml L1-L74](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/build.xml#L1-L74)

 [nbproject/build-impl.xml L1-L22](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L1-L22)

 [nbproject/genfiles.properties L1-L9](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/genfiles.properties#L1-L9)

---

## Main Build File (build.xml)

The `build.xml` file is the user-facing build configuration. It is minimal by design, importing all build logic from `build-impl.xml` and providing customization hooks.

### Project Definition

[build.xml L10-L12](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/build.xml#L10-L12)

 defines the project structure:

```

```

| Attribute | Value | Purpose |
| --- | --- | --- |
| `name` | `crud3` | Project identifier |
| `default` | `default` | Default target when no target specified |
| `basedir` | `.` | Project root directory |

The `<import>` statement at line 12 pulls in all build logic from the generated implementation file.

**Sources:** [build.xml L10-L12](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/build.xml#L10-L12)

### Customization Hook Targets

The build file documents numerous empty customization targets that can be overridden. These are defined in `build-impl.xml` and can be customized in `build.xml`:

| Hook Target | Execution Point | Purpose |
| --- | --- | --- |
| `-pre-init` | Before property initialization | Custom property setup |
| `-post-init` | After property initialization | Property validation |
| `-pre-compile` | Before compilation | Pre-compilation tasks |
| `-post-compile` | After compilation | Post-processing of classes |
| `-pre-jar` | Before JAR creation | Modify resources before packaging |
| `-post-jar` | After JAR creation | Additional packaging steps |
| `-post-clean` | After cleaning | Custom cleanup |

[build.xml L13-L72](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/build.xml#L13-L72)

 provides extensive documentation on these customization points with examples.

**Example customization pattern:**

```

```

The documentation also explains how to override main targets like `run`, `jar`, and `-do-jar` for advanced customization scenarios.

**Sources:** [build.xml L13-L72](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/build.xml#L13-L72)

---

## Generated Build Implementation (build-impl.xml)

The `nbproject/build-impl.xml` file contains the complete build implementation, automatically generated by NetBeans. The file header explicitly warns against manual editing:

[nbproject/build-impl.xml L2-L5](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L2-L5)

```

```

### File Structure Sections

The implementation is organized into logical sections as documented at [nbproject/build-impl.xml L6-L20](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L6-L20)

:

1. **Initialization** - Property loading and setup
2. **Compilation** - Source compilation logic
3. **JAR** - Archive creation
4. **Execution** - Running the application
5. **Debugging** - Debug support
6. **Javadoc** - Documentation generation
7. **Test compilation** - Test source compilation
8. **Test execution** - Test running
9. **Test debugging** - Test debug support
10. **Applet** - Applet-specific targets
11. **Cleanup** - Clean operation

### Ant Version Requirement

[nbproject/build-impl.xml L23-L29](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L23-L29)

 enforces a minimum Ant version:

```

```

For Java 9+ module support, Ant 1.10.0+ is required ([nbproject/build-impl.xml L86-L92](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L86-L92)

).

**Sources:** [nbproject/build-impl.xml L1-L92](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L1-L92)

---

## Build Initialization Sequence

The initialization phase loads properties from multiple sources in a specific order, allowing for property overrides at different levels.

```

```

**Diagram: Property Initialization Flow**

### Property Loading Order

The initialization follows a cascade pattern where later sources can override earlier ones:

1. **Private configuration** ([nbproject/build-impl.xml L40-L44](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L40-L44) ): * `nbproject/private/config.properties` * `nbproject/private/configs/${config}.properties` * `nbproject/private/private.properties`
2. **User properties** ([nbproject/build-impl.xml L45-L51](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L45-L51) ): * `${user.properties.file}` (typically in user's home directory) * Default fallbacks: `default.javac.source=1.8`, `default.javac.target=1.8`
3. **Project properties** ([nbproject/build-impl.xml L52-L55](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L52-L55) ): * `nbproject/configs/${config}.properties` (if config specified) * `nbproject/project.properties`

### Required Properties Validation

The `-init-check` target ([nbproject/build-impl.xml L290-L301](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L290-L301)

) validates that essential properties are set:

| Property | Purpose |
| --- | --- |
| `src.dir` | Source directory location |
| `test.src.dir` | Test source directory |
| `build.dir` | Build output directory |
| `dist.dir` | Distribution directory |
| `build.classes.dir` | Compiled classes location |
| `dist.javadoc.dir` | Javadoc output location |
| `build.test.classes.dir` | Compiled test classes location |
| `build.test.results.dir` | Test results directory |
| `build.classes.excludes` | Patterns to exclude from build |
| `dist.jar` | Output JAR file path |

**Sources:** [nbproject/build-impl.xml L36-L301](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L36-L301)

---

## Core Build Targets

The build system provides numerous targets for different build operations. The default target executes a complete build with tests.

### Default Target

[nbproject/build-impl.xml L30](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L30-L30)

:

```

```

This target orchestrates a full build: compiling sources, running tests, creating the JAR, and generating documentation.

### Primary Build Targets

```

```

**Diagram: Major Build Target Dependencies**

### Compilation Targets

| Target | Description | Key Dependencies |
| --- | --- | --- |
| `init` | Initialize build system | Property loading targets |
| `deps-jar` | Build project dependencies | `init`, `-deps-jar-init` |
| `compile` | Compile project sources | `init`, `deps-jar`, `-do-compile` |
| `compile-single` | Compile single file | `init`, `deps-jar`, `-do-compile-single` |
| `-do-compile` | Actual compilation execution | `-pre-compile`, `-copy-persistence-xml` |

The `-do-compile` target ([nbproject/build-impl.xml L1095-L1100](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L1095-L1100)

) performs:

1. Compilation via `<j2seproject3:javac>` macro
2. Resource copying from `${src.dir}` to `${build.classes.dir}`, excluding `.java` files and configured exclusions

### JAR Building Targets

| Target | Description | Dependencies |
| --- | --- | --- |
| `jar` | Build JAR file | `init`, `compile`, `-pre-jar`, `-do-jar`, `-post-jar`, `deploy` |
| `-do-jar-copylibs` | JAR with library copying | Manifest preparation, compilation |
| `-do-jar-jar` | Basic JAR creation | Manifest preparation, compilation |
| `-do-jar-set-mainclass` | Set Main-Class in manifest | `-do-jar-create-manifest` |

The JAR target determines whether to use `copylibs` (for library bundling) or basic JAR packaging based on module support and configuration ([nbproject/build-impl.xml L1184-L1197](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L1184-L1197)

).

### Testing Targets

| Target | Description | Dependencies |
| --- | --- | --- |
| `compile-test` | Compile test sources | `init`, `compile`, `-do-compile-test` |
| `test` | Run all unit tests | `init`, `compile-test`, `-do-test-run` |
| `test-single` | Run single test | `init`, `compile-test-single`, `-do-test-run-single` |
| `test-single-method` | Run single test method | `init`, `compile-test-single`, `-do-test-run-single-method` |

The test system supports both JUnit and TestNG frameworks, automatically detected based on classpath availability ([nbproject/build-impl.xml L263-L280](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L263-L280)

).

### Execution and Debugging Targets

| Target | Description | Dependencies |
| --- | --- | --- |
| `run` | Execute main class | `init`, `compile` |
| `debug` | Debug in IDE | `init`, `compile`, `-debug-start-debugger`, `-debug-start-debuggee` |
| `profile` | Profile application | `profile-init`, `compile` |

**Sources:** [nbproject/build-impl.xml L30](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L30-L30)

 [nbproject/build-impl.xml L1049-L1687](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L1049-L1687)

---

## Macrodef Definitions

The build system defines reusable Ant macros to encapsulate common operations. These provide parameterized build logic.

### Javac Macro

Three variations of the `javac` macro exist based on module support:

1. **With Module Support** ([nbproject/build-impl.xml L311-L377](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L311-L377) ): For Java 9+ named modules
2. **With Annotation Processors** ([nbproject/build-impl.xml L378-L420](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L378-L420) ): For Java 6-8 with annotation processing
3. **Without Processors** ([nbproject/build-impl.xml L421-L455](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L421-L455) ): Basic compilation for older Java versions

Key attributes:

| Attribute | Default Value | Purpose |
| --- | --- | --- |
| `srcdir` | `${src.dir}` | Source directory |
| `destdir` | `${build.classes.dir}` | Output directory |
| `classpath` | `${javac.classpath}` | Compilation classpath |
| `modulepath` | `${javac.modulepath}` | Module path (Java 9+) |
| `debug` | `${javac.debug}` | Debug information inclusion |

### Java Execution Macro

Three execution macros exist for different module scenarios:

1. **Named Module** ([nbproject/build-impl.xml L892-L925](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L892-L925) ): Executes with `module` attribute
2. **Unnamed Module** ([nbproject/build-impl.xml L926-L958](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L926-L958) ): Executes with modulepath but no module name
3. **Without Modules** ([nbproject/build-impl.xml L959-L985](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L959-L985) ): Traditional classpath execution

All execution macros support:

* File encoding via `-Dfile.encoding=${runtime.encoding}`
* JVM arguments via `${run.jvmargs}` and `${run.jvmargs.ide}`
* System properties prefixed with `run-sys-prop.`

### Copylibs Macro

[nbproject/build-impl.xml L987-L1017](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L987-L1017)

 defines the `copylibs` macro for creating self-contained JAR distributions:

1. Calculates classpath relative to `${build.classes.dir}`
2. Converts classpath to JAR manifest format
3. Invokes `CopyLibs` task to bundle libraries into `dist/lib/`
4. Creates manifest with `Class-Path` attribute

**Sources:** [nbproject/build-impl.xml L302-L1017](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L302-L1017)

---

## Module Support and Java 9+

The build system includes extensive support for Java Platform Module System (JPMS) introduced in Java 9.

### Module Detection

[nbproject/build-impl.xml L56-L62](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L56-L62)

 checks for module support:

```

```

If `javac.source` is 9 or higher, module support is enabled.

### Module Name Resolution

[nbproject/build-impl.xml L63-L84](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L63-L84)

 defines a macro to extract the module name from `module-info.java`:

```

```

### Module Properties

[nbproject/build-impl.xml L85-L120](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L85-L120)

 sets module-related properties:

| Property | Purpose |
| --- | --- |
| `module.name` | The module name from `module-info.java` |
| `named.module.internal` | Flag indicating a named module exists |
| `unnamed.module.internal` | Flag indicating no module-info present |
| `javac.modulepath` | Module path for compilation |
| `run.modulepath` | Module path for execution |
| `javac.upgrademodulepath` | Upgrade module path |

**Sources:** [nbproject/build-impl.xml L56-L120](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L56-L120)

---

## Conditional Build Logic

The build system uses extensive conditional logic to adapt to different environments and configurations.

### Condition Checking Examples

**JAR Archive Creation** ([nbproject/build-impl.xml L149-L156](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L149-L156)

):

```

```

**Test Framework Detection** ([nbproject/build-impl.xml L263-L280](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L263-L280)

):

```

```

**Platform-Specific Debug Transport** ([nbproject/build-impl.xml L867-L874](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L867-L874)

):

```

```

### Build Decision Flow

```

```

**Diagram: JAR Creation Strategy Selection**

**Sources:** [nbproject/build-impl.xml L149-L280](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L149-L280)

 [nbproject/build-impl.xml L867-L874](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L867-L874)

 [nbproject/build-impl.xml L1184-L1252](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L1184-L1252)

---

## CRC Tracking and Build File Generation

NetBeans tracks changes to build files using CRC checksums to determine when regeneration is needed.

### Genfiles Properties

[nbproject/genfiles.properties L1-L9](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/genfiles.properties#L1-L9)

 contains CRC values:

```

```

| CRC Property | Purpose |
| --- | --- |
| `.data.CRC32` | Hash of project configuration data |
| `.script.CRC32` | Hash of the generated script content |
| `.stylesheet.CRC32` | Version of XSLT stylesheet used for generation |

When the IDE detects mismatches, it regenerates `build-impl.xml` to reflect updated project configuration.

**Sources:** [nbproject/genfiles.properties L1-L9](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/genfiles.properties#L1-L9)

---

## Build Output and Artifacts

The build system produces various outputs during different phases.

### Directory Structure

```

```

**Diagram: Build Output Directory Structure**

### Compilation Output

The `compile` target produces:

* `.class` files in `${build.classes.dir}` (typically `build/classes/`)
* Copied resources (non-Java files from `src/`)
* Generated annotation processing sources in `${build.generated.sources.dir}`

### JAR Output

The `jar` target creates:

* `${dist.jar}` (typically `dist/crud3.jar`)
* Manifest with `Main-Class: GUI.GUI`
* Optional: bundled libraries in `${dist.dir}/lib/`

### Test Output

The `test` target generates:

* Compiled test classes in `${build.test.classes.dir}`
* XML test reports in `${build.test.results.dir}`
* Console test output

### Documentation Output

The `javadoc` target produces:

* HTML documentation in `${dist.javadoc.dir}`
* Package and class documentation
* Index files

**Sources:** [nbproject/build-impl.xml L1080-L1100](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L1080-L1100)

 [nbproject/build-impl.xml L1131-L1258](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L1131-L1258)

 [nbproject/build-impl.xml L1488-L1533](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L1488-L1533)

 [nbproject/build-impl.xml L1638-L1649](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L1638-L1649)

---

## Summary

The Ant build configuration for `crud3` implements a sophisticated two-tier architecture:

1. **build.xml** - User-editable customization layer with minimal content
2. **nbproject/build-impl.xml** - Generated implementation with complete build logic

Key characteristics:

* **Property cascade**: Private → User → Project configuration
* **Extensible hooks**: Pre/post targets for every major phase
* **Module support**: Java 9+ JPMS compatibility
* **Multi-framework testing**: JUnit and TestNG support
* **Conditional logic**: Adapts to environment and configuration
* **NetBeans integration**: IDE-generated with CRC tracking

The system supports standard development workflows (compile, test, jar, run, debug) while providing extensive customization points for advanced build scenarios.

**Sources:** [build.xml L1-L74](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/build.xml#L1-L74)

 [nbproject/build-impl.xml L1-L2167](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/build-impl.xml#L1-L2167)

 [nbproject/genfiles.properties L1-L9](https://github.com/axchisan/Crud-MUUUy-simple-en-java-de-hace-a-os/blob/7ec3bd78/nbproject/genfiles.properties#L1-L9)